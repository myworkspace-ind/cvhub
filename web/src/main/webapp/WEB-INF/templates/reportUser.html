<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User Report</title>
    <link rel="stylesheet" href="/library/webjars/bootstrap/5.2.0/css/bootstrap.min.css">
    <th:block th:include="fragments/head"></th:block>
</head>
<body>
<th:block th:include="fragments/hmenu"></th:block>
<div class="container mt-4">
    <h2>User Report</h2>

    <!-- Filter options -->
	<form method="get" action="user" class="form-inline mb-4">
	    <div class="d-flex align-items-center w-100">
	        <label for="period" class="mr-2">Filter by:</label>
	        <select id="period" name="period" class="form-control mr-3" style="width: 150px;">
	            <option value="today" th:selected="${selectedPeriod == 'today'}">Today</option>
	            <option value="week" th:selected="${selectedPeriod == 'week'}">This Week</option>
	            <option value="month" th:selected="${selectedPeriod == 'month'}">This Month</option>
	            <option value="year" th:selected="${selectedPeriod == 'year'}">This Year</option>
	        </select>
	
	        <label for="limit" class="mr-2">Records per page:</label>
	        <select id="limit" name="limit" class="form-control mr-3" style="width: 100px;">
	            <option value="5" th:selected="${limit == 5}">5</option>
	            <option value="10" th:selected="${limit == 10}">10</option>
	            <option value="20" th:selected="${limit == 20}">20</option>
	            <option value="50" th:selected="${limit == 50}">50</option>
	        </select>
	
	        <input type="hidden" name="page" th:value="${currentPage}" />
	        <button type="submit" class="btn btn-primary">Apply</button>
	    </div>
	</form>

    <!-- User table -->
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
            <tr>
            	<th>STT</th>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Created Date</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user, iterStat : ${users}">
            	<td th:text="${iterStat.index +1}"></td>
                <td th:text="${user.id}"></td>
                <td th:text="${user.fullName}"></td>
                <td th:text="${user.email}"></td>
                <td th:text="${'(+84) ' + user.phone.substring(1)}"></td>
                <td th:text="${#dates.format(user.createdDate, 'dd-MM-yyyy')}"></td>
                <td>
                <form method="post" th:action="@{/report/user/delete/{id}(id=${user.id})}" onsubmit="return confirm('Are you sure you want to delete this user?');">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
            </tr>
            <tr th:if="${users.size() == 0}">
                <td colspan="7" class="text-center">No users found for the selected period.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation" th:if="${totalPages > 0}">
        <ul class="pagination justify-content-center">
            <!-- Previous page -->
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link"
                   th:href="${currentPage > 0} ? @{/report/user(page=${currentPage - 1}, period=${selectedPeriod}, limit=${limit})} : '#'">
                    &laquo;
                </a>
            </li>

            <!-- Page numbers -->
            <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${pageNum == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/report/user(page=${pageNum}, period=${selectedPeriod}, limit=${limit})}"
                   th:text="${pageNum + 1}"></a>
            </li>

            <!-- Next page -->
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link"
                   th:href="${currentPage < totalPages - 1} ? @{/report/user(page=${currentPage + 1}, period=${selectedPeriod}, limit=${limit})} : '#'">
                    &raquo;
                </a>
            </li>
        </ul>
    </nav>
</div>
</body>
</html>
