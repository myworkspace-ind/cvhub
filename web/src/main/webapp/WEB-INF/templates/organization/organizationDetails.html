<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
<meta charset="UTF-8">
<title>Organization Details</title>
<link rel="stylesheet"
	th:href="@{/resources/main/organizationDetails.css}" />
<link rel="stylesheet" th:href="@{/resources/home/style.css}" />
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script type="text/javascript"
	th:src="@{/resources/organizationDetails/organizationDetails.js}"></script>
</head>

<body>
	<th:block th:include="fragments/hmenu"></th:block>

	<div class="container">
		<a href="/cvhub-web/main/report/organization" class="btn btn-primary">Quay
			lại</a>
		<div class="org-header">
			<div class="org-logo">
				<img th:src="@{/images/{logoId}(logoId=${organization.logoID})}"
					alt="Company logo">
			</div>
			<div class="org-info">
				<h1 class="org-name" th:text="${organization.title}"></h1>
				<p class="org-details" th:text="${organization.website}"></p>
				<div class="col-md-6 d-flex flex-wrap mt-4">
					<form th:action="@{/follow}" method="post">
						<input type="hidden" id="organizationId" name="organizationId"
							th:value="${organization.id}">
						<button type="submit"
							class="btn btn-outline-danger btn-light me-4"
							th:text="${isFollowing != null ? (isFollowing ? 'Unfollow' : 'Follow') : 'Follow'}"></button>
					</form>
					<button type="button" class="btn btn-danger" data-bs-toggle="modal"
						data-bs-target="#customerReviewModal">Write review</button>
				</div>
			</div>
			<!-- Kiểm tra user đã đăng nhập và là chủ của organization này -->
			<div th:if="${isOwner}">
				<form
					th:action="@{/organization/{orgId}/getCVs(orgId=${organization.id})}"
					method="get">
					<button id="" class="follow-btn">Quản lý CV đã ứng tuyển</button>
				</form>
			</div>
			<div th:if="${isOwner}">
				<button id="toggleJobForm" class="follow-btn">Thêm thông
					tin tuyển dụng</button>
			</div>
			<div th:if="${isOwner}">
				<form
					th:action="@{/organization/update/{orgId}(orgId=${organization.id})}"
					method="get">
					<button id="" class="follow-btn">Chỉnh sửa thông tin công
						ty</button>
				</form>
			</div>
		</div>

		<div class="content-section">
			<h2 class="section-title">Giới thiệu công ty</h2>
			<p th:text="${organization.summary}"></p>
			<p>Lý do gia nhập công ty:</p>
			<ul>
				<li th:text="${organization.detail}"></li>
			</ul>
		</div>

		<div class="content-section">
			<h2 class="section-title">Tuyển dụng</h2>
			<ul class="job-list">
				<li th:each="job : ${jobByOrganization}" class="job-item">
					<div>
						<div class="job-title" th:text="${job.title}"></div>
						<div class="job-location" th:text="${job.location.name}"></div>
						<div class="job-date" th:text="${job.createdDate}"></div>
					</div>
					<form th:action="@{/jobrequests/{id}(id=${job.id})}" method="get"
						style="display: inline;">
						<button type="submit" class="apply-btn">Chi Tiết</button>
					</form>

				</li>
			</ul>
		</div>

		<div class="content-section">
			<h2 class="section-title">Thông tin liên hệ</h2>
			<div class="contact-info">
				<div>
					<p>
						<strong>Địa chỉ công ty:</strong>
					</p>
					<p th:text="${organization.location}"></p>
				</div>
			</div>
		</div>
	</div>

	<div class="overlay" id="formOverlay"></div>
	<div id="jobPostForm">
		<h3>Thêm thông tin tuyển dụng</h3>
		<form id="requirementsForm" th:action="@{/jobrequests/registerJob}"
			method="post">
			<input type="hidden" id="organizationId" name="organizationId"
				th:value="${organization.id}">

			<!-- Row 1 -->
			<div class="form-row">
				<div class="form-group">
					<label for="namejob">Tên công việc cần tuyển dụng*</label> <input
						type="text" class="form-control" id="namejob" name="title"
						required>
				</div>
				<div class="form-divider"></div>
				<div class="form-group">
					<label for="industry">Mảng ngành nghề*</label> <select
						class="form-control" id="jobRoleId" name="jobRoleId" required>
						<option value="" selected disabled>Chọn Ngành Nghề Tuyển
							Dụng</option>
						<option th:each="alLJobRole : ${alLJobRole}"
							th:value="${alLJobRole.id}" th:text="${alLJobRole.title}"></option>
					</select>
				</div>
			</div>

			<!-- Row 2 -->
			<div class="form-row">
				<div class="form-group">
					<label for="locationCode">Địa điểm làm việc*</label> <select
						class="form-control" id="locationCode" name="locationCode"
						required>
						<option value="" selected disabled>Chọn địa điểm</option>
						<option th:each="location : ${locations}"
							th:value="${location.code}" th:text="${location.name}"></option>
					</select>
				</div>
				<div class="form-divider"></div>
				<div class="form-group">
					<label for="deadlineApplication">Hạn nộp hồ sơ*</label> <input
						type="date" id="deadlineApplication" name="deadlineApplication"
						required>
				</div>
			</div>

			<!-- Row 3 -->
			<div class="form-row">
				<div class="form-group">
					<label for="experience">Yêu cầu kinh nghiệm*</label> <input
						type="number" class="form-control" id="experience"
						name="experience" min="0" required
						placeholder="Nhập số năm kinh nghiệm"> <small
						class="form-text text-muted">Nhập số năm kinh nghiệm (0
						hoặc nhiều hơn).</small>
				</div>
				<div class="form-divider"></div>
				<div class="form-group">
					<label for="salaryOption">Lương Cơ bản ($) *</label> <select
						class="form-control" id="salaryOption" name="salaryOption"
						required onchange="toggleSalaryInput()">
						<option value="0" selected>Thỏa thuận</option>
						<option value="1">Nhập lương</option>
					</select> <input type="number" class="form-control mt-2" id="salary"
						name="salary" value="0" required style="display: none;"
						placeholder="Nhập lương" min="0">
				</div>
			</div>

			<!-- Row 4 -->
			<div class="form-row">
				<div class="form-group">
					<label for="requirementsCandidate">Yêu cầu ứng viên*</label>
					<textarea id="requirementsCandidate" name="requirementsCandidate"
						required
						placeholder="Nhập yêu cầu ứng viên (mỗi dòng là một gạch đầu dòng)"></textarea>
				</div>
				<div class="form-divider"></div>
				<div class="form-group">
					<label for="benefitCandidate">Quyền lợi ứng viên*</label>
					<textarea id="benefitCandidate" name="benefitCandidate" required
						placeholder="Nhập quyền lợi ứng viên (mỗi dòng là một gạch đầu dòng)"></textarea>
				</div>
			</div>

			<!-- Row 5 -->
			<div class="form-row">
				<div class="form-group">
					<label for="jobDescription">Chi tiết công việc*</label>
					<textarea id="jobDescription" name="jobDescription" required
						placeholder="Nhập chi tiết công việc (mỗi dòng là một gạch đầu dòng)"></textarea>
				</div>
			</div>


			<button type="submit" class="btn btn-primary">Lưu</button>
		</form>
	</div>



	<!-- Modal -->
	<div class="modal fade" id="customerReviewModal" tabindex="-1"
		aria-labelledby="customerReviewModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="customerReviewModalLabel">Customer
						Review</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form class="organization-review-form" id="reviewForm"
						th:action="@{/organizations/createReview}" method="post">
						<div>
							<p class="mt-4 mb-5 fs-6 fw-semibold text-body-emphasis">Your
								Rating*</p>
							<div class="form-group mb-6 d-flex justify-content-start">
								<div class="rate-input">
									<input type="radio" id="star5" name="rating" value="5">
									<label for="star5" title="text" class="mb-0 mr-1 lh-1">
										<i class="far fa-star"></i>
									</label> <input type="radio" id="star4" name="rating" value="4">
									<label for="star4" title="text" class="mb-0 mr-1 lh-1">
										<i class="far fa-star"></i>
									</label> <input type="radio" id="star3" name="rating" value="3">
									<label for="star3" title="text" class="mb-0 mr-1 lh-1">
										<i class="far fa-star"></i>
									</label> <input type="radio" id="star2" name="rating" value="2">
									<label for="star2" title="text" class="mb-0 mr-1 lh-1">
										<i class="far fa-star"></i>
									</label> <input type="radio" id="star1" name="rating" value="1">
									<label for="star1" title="text" class="mb-0 mr-1 lh-1">
										<i class="far fa-star"></i>

									</label>
								</div>
							</div>
						</div>

						<div class="form-group mb-7"></div>

						<div class="form-group mb-10">
							<label class="mb-4 fs-6 fw-semibold text-body-emphasis"
								for="reviewMessage">How was your overall experience?</label>
							<textarea id="reviewMessage" class="form-control" name="comment"
								rows="10"></textarea>

							<input type="hidden" id="organizationId" name="organizationId"
								th:value="${organization.id}">
						</div>

						<div class="d-flex">
							<button type="submit" class="btn btn-primary fw-semibold">Submit
								Now</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<style>
.organization-review-form .rate-input {
	direction: rtl
}

.organization-review-form .rate-input input {
	display: none
}

.organization-review-form .rate-input label {
	margin-left: 2px;
	margin-right: 2px;
	color: #9b9b9b;
	font-size: 18px
}

.organization-review-form .rate-input label:hover,
	.organization-review-form .rate-input label:hover
	 ~label, .organization-review-form .rate-input input:checked ~label,
	.organization-review-form .rate-input:hover>input:checked ~label {
	color: #004080
}

.organization-review-form .rate-input label:hover i::before,
	.organization-review-form .rate-input label:hover ~label i::before,
	.organization-review-form .rate-input input:checked ~label i::before,
	.organization-review-form .rate-input:hover>input:checked ~label i::before
	{
	content: '\f005';
	font-weight: 900
}
</style>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://www.google.com/recaptcha/api.js" async defer></script>
</body>

<script>
	$(document).ready(function() {
		// Khi người dùng nhấn submit, ngừng hành động mặc định của form
		$("#reviewForm").on("submit", function(e) {
			const modalElement = document.getElementById('customerReviewModal'); // Lấy phần tử modal
		    const modal = bootstrap.Modal.getInstance(modalElement); // Lấy instance modal
			e.preventDefault(); // Ngừng gửi form mặc định

			// Thu thập dữ liệu từ form
			var formData = {
				rating : $("input[name='rating']:checked").val(),
				comment : $("#reviewMessage").val(),
				organizationId : $("#organizationId").val()
			};

			// Gửi dữ liệu bằng AJAX
			$.ajax({
				url : '/cvhub-web/organizations/createReview', // URL controller xử lý
				type : 'POST',
				data : formData,
				success : function(response) {
					// Hiển thị thông báo thành công nếu gửi thành công
					alert(response.message);
					modal.hide(); // Ẩn modal
				},
				error : function() {
					// Hiển thị thông báo lỗi nếu có sự cố
					alert("An error occurred while submitting your review.");
					modal.hide(); // Ẩn modal
				}
			});
		});
	});
</script>

</html>